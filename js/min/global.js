function getCookie(a){var d,e,b=document.cookie,c=b.split("; ");for(d=0;d<c.length;d++)if(e=c[d].split("="),a==e[0])return e[1]}function setCookie(a,b,c){var e,d=new Date;d.setTime(d.getTime()+1e3*60*60*24*c),e="expires="+d.toUTCString(),document.cookie=a+"="+b+"; "+e}function enablePrint(){$(".hidden-print").removeClass("hidden-print")}function addKannma(a){var c,d,e,f,b=a+"";if(b=b.replace(new RegExp(",","g"),""),c="",/^([-+]).*$/.test(b)&&(c=b.replace(/^([-+]).*$/,"$1"),b=b.replace(/^([-+])(.*)$/,"$2")),/^[0-9]+(\.[0-9]+)?$/.test(b)){for(/^\./.test(b)&&(b="0"+b),d=b.replace(/^[0-9]+(\.[0-9]+)?$/,"$1"),e=b.replace(/^([0-9]+)(\.[0-9]+)?$/,"$1"),f=/(\d+)(\d{3})/;f.test(e);)e=e.replace(f,"$1,$2");return c+e+d}return a}function enableRight(){$("#downexcel,#print").removeClass("disabled")}function logout(){setCookie("key","",-1),setCookie("userId","",-1),setCookie("userName","",-1),setCookie("companyId","",-1),setCookie("companyName","",-1),location.href=loginurl}function replaceHtml(a){return(""+a).replace(new RegExp("&","gm"),"&amp;").replace(new RegExp("<","gm"),"&lt;").replace(new RegExp(">","gm"),"&gt;")}function areatypeDelete(a){var d,e,b=$(a).prev().attr("areatype"),c=$(a).prev().attr("range");$(a).closest("div").remove(),d=1,$("#businessarea .num").each(function(){$(this).text("商圏"+d+":"),d++}),e=Enumerable.From(businessArray).Where("$.areatype=="+b+" && $.arearange=="+c).ToArray(),$.each(e,function(){this.del=1})}function businessSetInit(){$("#businessareatype").val(1),$(".areatype").addClass("hidden"),$(".areatype:eq(0)").removeClass("hidden"),$(".areatype input.range").val(""),$(".areatype select").val(.5)}function businessArraySet(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(6!=a&&(d=Enumerable.From(businessArray).Where("$.areatype=="+a+" && $.arearange=="+b).Any()))return e=Enumerable.From(businessArray).Where("$.areatype=="+a+" && $.arearange=="+b).ToArray(),$.each(e,function(){this.del=0}),$("#businessarea").append(c),void 0;switch(a){case 1:businessArray.push({areatype:a,arearange:b,storecd:"0",mr:1e3*b,polygon:{},del:0,state:0}),$("#businessarea").append(c);break;case 2:f=0,0!=regionArray.length&&(f=Enumerable.From(regionArray).Where("$.sharerate<="+b).Max("$.mindistance")),businessArray.push({areatype:a,arearange:b,storecd:"0",mr:f,polygon:{},del:0,state:0}),$("#businessarea").append(c);break;case 3:case 4:case 5:switch(g=storeArray.length,h=0,i=0,a){case 3:i=3;break;case 4:i=2;break;case 5:i=1}$.each(storeArray,function(){var d=this;get("dcoords",{longitude:d["longitude"],latitude:d["latitude"],transportation:i,minute:b},function(e){var j,k,l,m,n,o,p,q,f=Enumerable.From(e).Select("{lng:$.x,lat:$.y}").ToArray(),i=new google.maps.Polygon({paths:f,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:1,fillColor:"#FF0000",fillOpacity:.35,visible:!1});for(i.setMap(map),j=0,k=new google.maps.LatLng({lat:d["latitude"],lng:d["longitude"]}),l=i.getPath().getLength(),m=[],n=0;l>n;n++)o=i.getPath().getAt(n),p=google.maps.geometry.spherical.computeDistanceBetween(k,o),m.push(p);q=Math.max.apply(null,m),q>j&&2e4>=q?j=q:q>2e4&&(j=2e4),businessArray.push({areatype:a,arearange:b,storecd:d["storecd"],mr:j,polygon:i,del:0,state:0}),h++,g==h&&$("#businessarea").append(c)})});break;case 6:for(f=0,j=0;j<storeArray.length;j++){for(k=storeArray[j],l=new google.maps.LatLng({lat:k["latitude"],lng:k["longitude"]}),m=freeBusinessArea.getPath().getLength(),n=[],o=0;m>o;o++)p=freeBusinessArea.getPath().getAt(o),q=google.maps.geometry.spherical.computeDistanceBetween(l,p),n.push(q);r=Math.min.apply(null,n),s=Math.max.apply(null,n),s>f&&2e4>=s?f=s:s>2e4&&2e4>r?f=2e4:r>=2e4&&google.maps.geometry.poly.containsLocation(l,freeBusinessArea)&&(f=2e4)}t=new google.maps.Polygon({strokeColor:"#605ca8",strokeOpacity:1,strokeWeight:3,fillOpacity:0}),t.setPath(freeLinePath),businessArray.push({areatype:a,arearange:b,storecd:"0",mr:f,polygon:t,del:0,state:0}),$("#businessarea").append(c)}}function initEle(){$("#set").click(function(){var a,b,c;$("#settings").toggle(),$("#settings").is(":visible")?($("#businessarea div").remove(),a=1,b=$("#businessarea"),$.each(businessArray,function(){this.del=1}),c=Enumerable.From(businessArray).Where("$.state==1").ToArray(),$.each(c,function(){this.del=0}),$("#set").nextAll().each(function(){var c='<div><span class="num">商圏'+a+":</span>"+'<span class="glyphicon glyphicon-remove-sign" onclick="areatypeDelete(this);"></span></div>';a++,b.append(c),b.find(".num").last().after($(this).clone())})):(businessSetInit(),lineArea.setPath([]),linePath=[],freeBusinessArea.setPath([]),google.maps.event.clearListeners(map,"click"),$.tremaps.mapRegionShow())}),$("#businessareatype").change(function(){$(".areatype input.range").val(""),$(".areatype select").val(.5),$(".areatype").addClass("hidden");var a=$(this).val();switch(a){case"1":$(".areatype:eq(0)").removeClass("hidden");break;case"2":$(".areatype:eq(1)").removeClass("hidden");break;case"3":case"4":case"5":$(".areatype:eq(2)").removeClass("hidden");break;case"6":$(".areatype:eq(3)").removeClass("hidden")}"6"==a?(lineArea.setPath([]),linePath=[],$("#businessarea .label").is("[areatype='6']")||freeBusinessArea.setPath([]),$.tremaps.mapRegionHide(),google.maps.event.addListener(map,"click",drawPoly),$.tremaps.addListeners(mapBusinessArray,drawPoly)):(google.maps.event.clearListeners(map,"click"),$.tremaps.clearListeners(mapBusinessArray)),$(".areatype:visible .range").focus()}),$("#btnCancle").click(function(){$("#businessarea .label").is("[areatype='6']")||(lineArea.setPath([]),linePath=[],freeBusinessArea.setPath([]),google.maps.event.clearListeners(map,"click"),google.maps.event.addListener(map,"click",drawPoly))}),$("#btnOk").click(function(){return lineArea.getPath().length<=2?($.tremaps.showMessage("M-014"),void 0):(lineArea.setMap(null),freeLinePath=linePath,freeBusinessArea.setPath(freeLinePath),freeBusinessArea.setMap(map),google.maps.event.clearListeners(map,"click"),void 0)}),$("#btnAdd").click(function(){var c,d,e,f,g,h,i,a=Enumerable.From(businessArray).Where("$.del==0").Select("{areatype:$.areatype,arearange:$.arearange}").ToArray(),b=[];if($.each(a,function(){b.push(this.areatype+"_"+this.arearange)}),c=Enumerable.From(b).Distinct().Count(),c>=3)return $.tremaps.showMessage("M-008"),void 0;if(d=parseInt($("#businessareatype").val()),f=$(".areatype:visible .range").val(),e=1*f,6!=d&&$("#businessarea .label[areatype='"+d+"']").is("[range='"+e+"']"))return $.tremaps.showMessage("M-009"),void 0;switch(g="",h="",d){case 1:if(""==f)return $.tremaps.showMessage("M-012"),void 0;if(i=/^\d+(\.\d{1})?$/,!(e>=.1&&20>=e&&i.test(e)))return $.tremaps.showMessage("M-007"),void 0;g="円商圏:"+e+"km",h="label-danger";break;case 2:g="売上シェア商圏:"+10*e+"割",h="label-success";break;case 3:case 4:case 5:if(""==f)return $.tremaps.showMessage("M-011"),void 0;if(!(e>0&&60>=e))return $.tremaps.showMessage("M-010"),void 0;switch(d){case 3:g="ドライブ商圏(徒歩):"+e+"分";break;case 4:g="ドライブ商圏(自動車):"+e+"分";break;case 5:g="ドライブ商圏(自動車-高速):"+e+"分"}h="label-info";break;case 6:if($("#businessarea .label").is("[areatype='6']"))return $.tremaps.showMessage("M-047"),void 0;if(0==lineArea.getPath().length)return $.tremaps.showMessage("M-014"),void 0;if(lineArea.getPath().length>0&&0==freeBusinessArea.getPath().length)return $.tremaps.showMessage("M-013"),void 0;if($("#businessarea .label").is("[areatype='6']"))return $.tremaps.showMessage("M-047"),void 0;e=0,g="フリー商圏",h="label-primary"}""!=g&&(h='<div><span class="num">商圏'+(c+1)+':</span><span areatype="'+d+'" range="'+e+'" class="label '+h+'">'+g+'</span><span class="glyphicon glyphicon-remove-sign" onclick="areatypeDelete(this);"></span></div>',businessArraySet(d,e,h),businessSetInit())}),$("#btndetermine").click(function(){var c,d,e,f,g,a=Enumerable.From(businessArray).Where("$.del==0").Select("{areatype:$.areatype,arearange:$.arearange}").ToArray(),b=[];return $.each(a,function(){b.push(this.areatype+"_"+this.arearange)}),c=Enumerable.From(b).Distinct().Count(),0==c?($.tremaps.showMessage("M-006"),void 0):(infowindow.open(null),d=storeArray[0],e={lat:d["latitude"],lng:d["longitude"]},f=mapStoreArray[0],f.setPosition(e),lineArea.setPath([]),linePath=[],google.maps.event.clearListeners(map,"click"),freeBusinessArea.setPath([]),$.tremaps.mapBusinessClear(),$.tremaps.mapRegionHide(),mapRegionShowArray=[],g=parseInt($(this).attr("flag")),$("#set").nextAll().remove(),$("#set").after($("#businessarea .label").clone()),getSikunion(g),$("#settings").toggle(),businessSetInit(),void 0)}),$("#cooperations").on("hidden.bs.dropdown",function(){var a,b;class0Array=[],class1Array=[],a=$("#cooperations .menul2[companyflg=0]"),b=$("#cooperations .menul2[companyflg=1]"),a.each(function(){$(this).find("input").is(":checked")&&class0Array.push($(this).closest("li").attr("classcd"))}),b.each(function(){$(this).find("input").is(":checked")&&class1Array.push($(this).closest("li").attr("classcd"))}),showCooperations(class0Array,class1Array)}),$("#competitors").on("hidden.bs.dropdown",function(){classCompanyArray=[],$("#competitors .menul2").each(function(){if($(this).find("input").is(":checked")){var a=$(this).closest("li").attr("c_companycd");a.split("_"),classCompanyArray.push(a)}}),showCompetitors(classCompanyArray)})}function checkmenu(a){var b,c,d,e,f;a.is(".selectall")?(b=$("#competitors .menul1 input"),c=$("#competitors .menul2 input"),d=!0,d=a.find("input").is(":checked")?!0:!1,$.each(b,function(){this.checked=d}),$.each(c,function(){this.checked=d})):a.is(".menul1")?(e=a.next().find("input"),d=!0,d=a.find("input").is(":checked")?!0:!1,$.each(e,function(){this.checked=d}),$("#competitors .selectall input")[0].checked=0==$("#competitors .menul1 input:checkbox:not(:checked)").length?!0:!1):(f=a.closest(".dropdown-submenu").find(".menul1 input"),c=a.closest(".dropdown-menu").find(".menul2 input"),d=!0,c.each(function(){return $(this).is(":checked")?void 0:(d=!1,void 0)}),f[0].checked=d,$("#competitors .selectall input")[0].checked=0==$("#competitors .menul1 input:checkbox:not(:checked)").length?!0:!1)}function menuClick(a){var c,d,b=$(a.target).closest("a");return $(a.target).is("input")?(checkmenu(b),void 0):(c=$(a.currentTarget),d=c.find("input"),d[0].checked=d.is(":checked")?!1:!0,checkmenu(b),$(a.target).blur(),!1)}function cc(){var b,c,a=$("#cooperations .dropdown-submenu>.dropdown-menu");a.empty(),b=$("#competitors>.dropdown-menu"),b.empty(),c=$("#cooperations .menul1 input"),$.each(c,function(){this.checked=!1}),get("mcooperation",{},function(a){var c,b=$("#hidcompanycd").val();Enumerable.From(a).Where("$.c=='"+b+"'").Distinct("$.a").OrderBy("$.b").Select(function(a){return $("<li classcd='"+a.a+"''><a companyflg='0' class='menul2' href='javascript:;'><input type='checkbox'/>"+a.b+"</a></li>")[0]}).TojQuery().appendTo("#cooperations>.dropdown-menu>li:eq(0)>.dropdown-menu"),Enumerable.From(a).Where("$.c!='"+b+"'").Distinct("$.a").OrderBy("$.b").Select(function(a){return $("<li classcd='"+a.a+"''><a companyflg='1' class='menul2' href='javascript:;'><input type='checkbox'/>"+a.b+"</a></li>")[0]}).TojQuery().appendTo("#cooperations>.dropdown-menu>li:eq(1)>.dropdown-menu"),$("#cooperations .dropdown-menu a").unbind("click"),$("#cooperations .dropdown-menu a").on("click",function(a){return menuClick(a)}),(0!=class0Array.length||0!=class1Array.length)&&($.each(class0Array,function(){$("#cooperations li[classcd='"+this+"'] a[companyflg='0'] input")[0].checked=!0}),$.each(class1Array,function(){$("#cooperations li[classcd='"+this+"'] a[companyflg='1'] input")[0].checked=!0}),c=$("#cooperations .menul1"),$.each(c,function(){var a=$(this).next().find("input").length,b=$(this).next().find("input:checked").length;b==a&&($(this).find("input")[0].checked=!0)}))}),get("mcompetition",{companycd:$("#hidcompanycd").val()},function(a){var c,d,e,f,g,h,i;for(competitordatas=a,c="<li class='nc'><a class='selectall' href='javascript:;'><input type='checkbox'/>すべて</a></li>",d=Enumerable.From(a).Distinct("$.b").OrderBy("$.c").Select("{c_classcd:$.b,c_classname:$.c}").ToArray(),e=0;e<d.length;e++)if(f=d[e],g=Enumerable.From(a).Where("$.b=='"+f["c_classcd"]+"'").Distinct("$.d").OrderBy("$.e").Select("{c_classcd:$.b,c_companycd:$.d,c_companyname:$.e}").ToArray(),g.length>0){for(c=c+"<li class='dropdown-submenu'><a class='menul1' href='javascript:;'><input type='checkbox'/>"+f["c_classname"]+"</a><ul class='dropdown-menu'>",h=0;h<g.length;h++)c=c+"<li c_companycd='"+g[h]["c_classcd"]+"_"+g[h]["c_companycd"]+"''><a class='menul2' href='javascript:;'><input type='checkbox'/>"+g[h]["c_companyname"]+"</a></li>";c+="</ul></li>"}else c=c+"<li><a class='menul1' href='javascript:;'><input type='checkbox'/>"+f["c_classname"]+"</a></li>";b.append(c),$("#competitors .dropdown-menu a").unbind("click"),$("#competitors .dropdown-menu a").on("click",function(a){return menuClick(a)}),0!=classCompanyArray.length&&($.each(classCompanyArray,function(){$("#competitors li[c_companycd='"+this+"'] input")[0].checked=!0}),i=$("#competitors .menul1"),$.each(i,function(){var a=$(this).next().find("input").length,b=$(this).next().find("input:checked").length;b==a&&($(this).find("input")[0].checked=!0)}))})}function showCooperations(a,b){var h,i,c="",d=[],e=[],f=[],g=[];for(a.length>0&&(c+="0",d.push(a.join("_"))),b.length>0&&(c+="1",d.push(b.join("_"))),h=0;h<mapCooperationArray.length;h++)mapCooperationArray[h].setMap(null);if(0!=d.length){for(h=0;h<storeArray.length;h++)i=storeArray[h],e.push(i["storecd"]),f.push(i["latitude"]),g.push(i["longitude"]);get("dcooperation",{companycd:$("#hidcompanycd").val(),companyflg:c,classcd:d.join(","),storecd:e.join("_"),longitude:g.join("_"),latitude:f.join("_")},function(a){var b=a;mapCooperationArray=$.tremaps.competitorCreate(b)})}}function showCompetitors(a){var g,h,b=[],c=[],d=[],e=[],f=[];for($.each(a,function(){var a=this.split("_");b.push(a[0]),c.push(a[1])}),g=0;g<mapCompetitorArray.length;g++)mapCompetitorArray[g].setMap(null);if(0!=b.length){for(g=0;g<storeArray.length;g++)h=storeArray[g],d.push(h["storecd"]),e.push(h["latitude"]),f.push(h["longitude"]);get("dcompetition",{companycd:$("#hidcompanycd").val(),classcd:b.join("_"),kygcompany:c.join("_"),storecd:d.join("_"),longitude:f.join("_"),latitude:e.join("_")},function(a){var b=a;mapCompetitorArray=$.tremaps.competitorCreate(b)})}}function businessCircleCreate(){var a=Enumerable.From(businessArray).Where("$.del==0").ToArray();$.each(a,function(){var g,a=this,b=a["areatype"],c=a["arearange"],d=a["storecd"],e=a["polygon"],f=a["mr"];switch(b){case 1:$.tremaps.circleAreaCreate(c);break;case 2:$.tremaps.saleAreaCreate(c);break;case 3:case 4:case 5:case 6:g=6==b?$.tremaps.drawDashedPolygon(e.getPath().getArray(),"#605ca8"):$.tremaps.drawDashedPolygon(e.getPath().getArray(),"#00c0ef"),$.tremaps.polygonAreaCreate(d,b,c,e,g,f)}}),$("#showlabel").is(":checked")&&$.tremaps.showMapLabel()}function businessCircleReCreate(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(arealevel=getMapPara().arealevel,a=[],b=0;b<mapRegionShowArray.length;b++)a.push(mapRegionShowArray[b]);for(mapRegionShowArray=[],$.tremaps.mapBusinessClear(),c=Enumerable.From(a).Where("$.areatype==1 || $.areatype==2").ToArray(),d=Enumerable.From(a).Where("$.areatype!=1 && $.areatype!=2").ToArray(),e=Enumerable.From(c).Select("{areatype:$.areatype,arearange:$.arearange}").ToArray(),f=[],$.each(e,function(){f.push(this.areatype+"_"+this.arearange)}),g=Enumerable.From(f).Distinct().ToArray(),h=[],$.each(g,function(){var a=this.split("_");h.push({areatype:parseInt(a[0]),arearange:parseFloat(a[1])})}),b=0;b<h.length;b++)switch(i=h[b],j=i["areatype"],k=i["arearange"],j){case 1:$.tremaps.circleAreaCreate(k);break;case 2:$.tremaps.saleAreaCreate(k)}for(b=0;b<d.length;b++)switch(i=d[b],l=i["storecd"],j=i["areatype"],k=i["arearange"],m=i["area"],n=i["dashed"],o=i["mr"],j){case 3:case 4:case 5:$.tremaps.polygonAreaCreate(l,j,k,m,n,o);break;case 6:$.tremaps.polygonAreaCreate(0,j,0,m,n,o)}$("#showlabel").is(":checked")&&$.tremaps.showMapLabel()}function reShow(a){var b,c,d,e,f,g;switch($.tremaps.mapRegionInit(),infowindow.open(null),b=getMapPara(),a){case 1:c="dsareas",d="{sikunioncd:$.b.substring(0,5)+'000000',storecd:$.a,areacd:$.b,mindistance:parseFloat($.d),sharerate:$.f,optionvalue:$.c}";break;case 3:c="newstorearea",d="{sikunioncd:$.a.substring(0,5)+'000000',areacd:$.a,optionvalue:$.c,mindistance:parseFloat($.d)}",e=storeArray[0],f={lat:e["latitude"],lng:e["longitude"]},g=mapStoreArray[0],g.setPosition(f)}get(c,b,function(b){var c,e,f,g,h,i,j;if(regionArray=Enumerable.From(b).Select(d).ToArray(),disSikunionArray=Enumerable.From(regionArray).GroupBy("$.sikunioncd",null,function(a,b){var c={sikunioncd:a,mindistance:b.Min("$.mindistance")};return c}).ToArray(),disRegionArray=Enumerable.From(regionArray).Distinct("$.areacd").ToArray(),arealevel!=getMapPara().arealevel)if($.tremaps.hideMapLabel(),$.tremaps.mapRegionClear(),c=Enumerable.From(businessArray).Where("$.del==0").Max("$.mr"),e=Enumerable.From(disSikunionArray).Where("$.mindistance<="+c).Select("{sikunioncd:$.sikunioncd,mindistance:$.mindistance}").ToArray(),0==e.length?disSikunionArray.length>0&&(f=Enumerable.From(disSikunionArray).Min("$.mindistance"),e=[],e[0]=Enumerable.From(disSikunionArray).Where("$.mindistance=="+f).First(),maxRange=f):maxRange=c,g=e.length,h=0,0==g)businessCircleReCreate();else for(i="/level4_sikunion/","arealevel3"==getMapPara().arealevel&&(i="/level3_sikunion/"),j=0;j<e.length;j++)$.getJSON(i+e[j]["sikunioncd"]+".json?v=1.0.0.0",function(b){var e,c=Enumerable.From(b).Join(disRegionArray,"$.areacd","$.areacd","$").ToArray(),d=c.length;for(h++,e=0;d>e;e++)$.tremaps.jsonPolygonsCreate(c[e],a),g==h&&e==d-1&&businessCircleReCreate()});else businessCircleReCreate()},{stopIfNull:!1})}function getSikunion(a){var b,c,d,e,f,g,h,i;if($("#print-circle").text(Enumerable.From($(".maphead-left .label")).ToString(" / ","$.innerHTML")),b="/level4_sikunion/","arealevel3"==getMapPara().arealevel&&(b="/level3_sikunion/"),$.each(businessArray,function(){this.state=0}),c=Enumerable.From(businessArray).Where("$.del==0").ToArray(),$.each(c,function(){this.state=1}),d=Enumerable.From(businessArray).Where("$.del==0").Max("$.mr"),d>maxRange)if(e=Enumerable.From(disSikunionArray).Where("$.mindistance>"+maxRange+" && $.mindistance<="+d).Select("{sikunioncd:$.sikunioncd,mindistance:$.mindistance}").ToArray(),0==e.length?(disSikunionArray.length>0&&(f=Enumerable.From(disSikunionArray).Min("$.mindistance"),e=[],e[0]=Enumerable.From(disSikunionArray).Where("$.mindistance=="+f).First()),maxRange=f>d?f:d):maxRange=d,g=e.length,h=0,0==g)businessCircleCreate();else for(i=0;i<e.length;i++)$.getJSON(b+e[i]["sikunioncd"]+".json?v=1.0.0.0",function(b){var e,c=Enumerable.From(b).Join(disRegionArray,"$.areacd","$.areacd","$").ToArray(),d=c.length;for(h++,e=0;d>e;e++)$.tremaps.jsonPolygonsCreate(c[e],a),g==h&&e==d-1&&businessCircleCreate()});else businessCircleCreate()}function storesCreate(a,b){var c,d,e,f,g;switch(maxRange=0,arealevel="arealevel4",c=getMapPara(),3==a&&$.data(document,"auth")&&google.maps.event.addListener(map,"rightclick",competitorAdd),$.tremaps.ccInit(),$.tremaps.mapStoreClear(),$.tremaps.mapRegionClear(),$.tremaps.mapBusinessClear(),$.tremaps.hideMapLabel(),regionArray=[],disSikunionArray=[],disRegionArray=[],mapRegionShowArray=[],businessArray=[],infowindow.open(null),$("#settings").hide(),$(".businessarea").removeClass("open"),$(".businessarea").hide(),$("#mapheader,#save-widget").show(),$("#businessarea div").remove(),$("#set").nextAll().remove(),d=parseFloat(c.circlevalue),e='<div><span class="num">商圏1:</span><span areatype="1" range="'+d+'" class="label label-danger">円商圏:'+d+'km</span><span class="glyphicon glyphicon-remove-sign" onclick="areatypeDelete(this);"></span></div>',a){case 1:$.tremaps.storesCreate(),f="dsareas",g="{sikunioncd:$.b.substring(0,5)+'000000',storecd:$.a,areacd:$.b,mindistance:parseFloat($.d),sharerate:$.f,optionvalue:$.c}";break;case 3:0==b?$.tremaps.redStoreCreate():$.tremaps.blueStoreCreate(),f="newstorearea",g="{sikunioncd:$.a.substring(0,5)+'000000',areacd:$.a,optionvalue:$.c,mindistance:parseFloat($.d)}",$("#pac-input").removeClass("state0"),$("#pac-input").addClass("state1"),$("#pac-input").show()}get(f,c,function(b){regionArray=Enumerable.From(b).Select(g).ToArray(),disSikunionArray=Enumerable.From(regionArray).GroupBy("$.sikunioncd",null,function(a,b){var c={sikunioncd:a,mindistance:b.Min("$.mindistance")};return c}).ToArray(),disRegionArray=Enumerable.From(regionArray).Distinct("$.areacd").ToArray(),businessArraySet(1,d,e),$("#set").after($("#businessarea .label").clone()),getSikunion(a),enablePrint()},{stopIfNull:!1})}function checkKeyForFloat(a,b){var c=!1,d=window.event?b.keyCode:b.which;return d>95&&106>d||d>47&&60>d||110==d&&a.indexOf(".")<0||190==d&&a.indexOf(".")<0||8==d||9==d||46==d||37==d||39==d?c=!0:window.event?b.returnValue=!1:b.preventDefault(),c}function checkKeyForInt(a,b){var c=!1,d=window.event?b.keyCode:b.which;return d>95&&106>d||d>47&&60>d||8==d||9==d||46==d||37==d||39==d?c=!0:window.event?b.returnValue=!1:b.preventDefault(),c}function InputLimit(){function b(a,b){var d,c={};for(d=0;d<a.length&&d<b.length;d++)c[a.charCodeAt(d)]=b.charAt(d);return c}this.type=0,this.ua={},this.ua.name=window.navigator.userAgent.toLowerCase(),this.ua.appv=window.navigator.appVersion.toLowerCase(),this.ua.isIE=this.ua.name.indexOf("msie")>=0||this.ua.name.indexOf("trident")>=0,this.ua.isIE6=this.ua.isIE&&this.ua.appv.indexOf("msie 6.")>=0,this.ua.isIE7=this.ua.isIE&&this.ua.appv.indexOf("msie 7.")>=0,this.ua.isIE8=this.ua.isIE&&this.ua.appv.indexOf("msie 8.")>=0,this.ua.isIE9=this.ua.isIE&&this.ua.appv.indexOf("msie 9.")>=0,this.ua.isIE10=this.ua.isIE&&this.ua.appv.indexOf("msie 10.")>=0,this.ua.isIE11=this.ua.name.indexOf("trident")>=0,this.ua.isFirefox=this.ua.name.indexOf("firefox")>=0,this.ua.isOpera=this.ua.name.indexOf("opera")>=0,this.ua.isChrome=this.ua.name.indexOf("chrome")>=0,this.ua.isSafari=this.ua.name.indexOf("safari")>=0&&!this.ua.isChrome,this.ua.isiPhone=this.ua.name.indexOf("iphone")>=0,this.ua.isiPod=this.ua.name.indexOf("ipod")>=0,this.ua.isiPad=this.ua.name.indexOf("ipad")>=0,this.ua.isiOS=this.ua.isiPhone||this.ua.isiPod||this.ua.isiPad,this.ua.isAndroid=this.ua.name.indexOf("android")>=0,this.ua.isTablet=this.ua.isiPad||this.ua.isAndroid&&this.ua.name.indexOf("mobile")<0,this.zenkaku2alphabet=!1,this.map_zenkaku2alphabet=b("１２３４５６７８９０あいうえおあｂｃｄえｆｇｈいｊｋｌｍｎおｐｑｒｓｔうｖｗｘｙｚ　！”＃＄％＆’（）ー＾￥＠「；：」、。・￥＝～｜‘｛＋＊｝＜＞？＿","1234567890aiueoabcdefghijklmnopqrstuvwxyz !\"#$%&'()-^@[;:],./=~|`{+*}<>?_"),this.z2h=!1,this.map_z2h=b("１２３４５６７８９０。","1234567890."),this.zenkakuNumber2hankakuNumber=!1,this.map_zenkakuNumber2hankakuNumber=b("１２３４５６７８９０","1234567890")}var lineArea,freeBusinessArea,map,productLevelNum,storeUploader,competitorUploader,Month,Option,UpdateFile,DownLoadFile,fields=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","aa","ab","ac","ad","ae","af","ag","ah","ai","aj","ak","al","am","an","ao","ap","aq","ar","as","at","au","av","aw"],loginurl="/menu/login",url="/webgis/",urlpaths={mcompanys:"master/companys",mstores:"master/stores",mdates:"master/dates",mproducttitles:"master/producttitles",mproducts:"master/products",moptions:"master/options",mranges:"master/ranges",mcooperation:"master/cooperation",mcompetition:"master/competition",mcompetitiontype:"master/competitiontype",dsareas:"data/store/areas",test:"data/storetest",darea:"data/areas/{0}",dnewstorearea:"data/newstore/areas/{0}",dareas:"data/areas",dareas1:"data/areas/1",danalysis:"data/analysis",dcompetition:"data/competition",dcooperation:"data/cooperation",dcoords:"data/coords",dcircletotals:"data/circletotals",emap:"excel/map",ecompetition:"excel/competition",estore:"excel/store",ageband:"master/options/{0}/ageband",rightmenu:"master/rightmenu",newstorearea:"data/newstore/areas",dnewstoretotals:"data/newstore/circletotals",eanalysis:"data/analysis/{0}",A001:"excel/adm/map",A002:"data/adm/circletotals",A003:"data/adm/areas/{0}"},Enumerable=$.Enumerable,storeArray=[],regionArray=[],disSikunionArray=[],disRegionArray=[],businessArray=[],storeRegionArray=[],linePath=[],freeLinePath=[],colorLevel=["#2892C7","#68A6B3","#95BD9F","#BFD48A","#E7ED72","#FCE45B","#FCB344","#FA8532","#F25622","#E81014"],levelArray=[],mapStoreArray=[],mapRegionArray={},mapRegionShowArray=[],mapBusinessArray=[],mapCooperationArray=[],mapCompetitorArray=[],competitordatas=[],class0Array=[],class1Array=[],classCompanyArray=[],bounds=null,messages={"M-001":"100店以上の表示ができないので、もっと条件の絞りをください。","M-002":"該当する店舗が見つかりませんでした。","M-003":"対象店舗を選択してください。","M-004":" 出力できるものがありません。まず地図表示してください。","M-005":"印刷できるものがありません。まず地図表示してください。","M-006":"商圏は最低1つ以上設定してください。","M-007":"距離は0.1～20.0までの小数を入力してください。","M-008":"商圏は最大3つまで設定してください。","M-009":"同じ商圏はすでに設定されています。別の商圏を設定してください。","M-010":"ドライブタイムは1～60までの整数を入力してください。","M-011":"ドライブ商圏の時間を入力してください。","M-012":"円商圏の距離を設定しだくだい。","M-013":"フリー商圏は描画中です。「完了」ボタンをクリックしてから、追加してください。","M-014":"フリー商圏を描画してから、追加してください。","M-015":"店舗名を入力してください。","M-016":"競合店登録しました。","M-017":"競合店の登録に失敗しました。","M-018":"競合店マスタをアップロードしました。","M-019":"競合店マスタのアップロードに失敗しました。フォーマットを確認してください。","M-020":"競合店マスタのアップロードに失敗しました。もう一度アップロードしてください。","M-021":"サーバーに接続できません。","M-022":"ACTサービスに接続中です。","M-023":"最大5つ店舗を選択してください。","M-028":"店舗マスタをアップロードしました。","M-029":"店舗マスタのアップロードに失敗しました。フォーマットを確認してください。","M-030":"店舗マスタのアップロードに失敗しました。もう一度アップロードしてください。","M-034":"行政区域を選択してください。","M-035":"分析地を登録しました。","M-036":"分析地の登録が失敗でした。","M-037":"分析地を修正しました。","M-038":"分析地の修正に失敗しました。","M-039":"分析地を削除しました。","M-040":"分析地の削除に失敗しました。","M-041":"該当する市区町村が見つかりませんでした。","M-042":"該当する町・大字が見つかりませんでした。","M-043":"該当する丁目・字が見つかりませんでした。","M-044":"サーバの接続には問題がありそうですので、管理者と連絡をしてください。","M-045":"行政区域を最小地域を選択してください。","M-046":"分析地名を入力してください。","M-047":"フリー商圏が一つしか設定できないです。","M-048":"年代を選択してください。","M-049":"該当するデータがありません。","M-050":"CSVファイルを選択してください。"},maxRange=0,arealevel="arealevel4";String.prototype.format=function(a){var c,d,e,b=this;if(arguments.length>0)if(1==arguments.length&&"object"==typeof a)for(c in a)void 0!=a[c]&&(d=new RegExp("({"+c+"})","g"),b=b.replace(d,a[c]));else for(e=0;e<arguments.length;e++)void 0!=arguments[e]&&(d=new RegExp("({)"+e+"(})","g"),b=b.replace(d,arguments[e]));return b},Month={data:{},setData:function(a){Month.data=Enumerable.From(a).OrderByDescending("$.a"),Month.fillData()},fillData:function(){Month.data.Select(function(a){return $("<option value='"+a.a+"'>").text(a.b)[0]}).TojQuery().appendTo("#month0"),Month.data.Select(function(a){return $("<option value='"+a.a+"'>").text(a.c)[0]}).TojQuery().appendTo("#month1"),Month.data.Select(function(a){return $("<option value='"+a.a+"'>").text(a.d)[0]}).TojQuery().appendTo("#month2")},fillCompareMonth:function(){$comparemonth=$("#comparemonth"),$comparemonth.html($("#month0").html()),$comparemonth.children("option[value='"+$("#month0").val()+"']").remove(),$comparemonth.show()}},Option={data:{},defaultValue:"",setData:function(a){Option.data=Enumerable.From(a),$.data(document,"option",Option.data),Option.fillData(0)},getCondition:function(){var a="1";return a+=$(".select-product").length>0?$(".select-product option:selected[value!='0']").length>0?" && $.l==1":" && $.k==1":$("#area4").length>0?" && $.n==1":" && $.m==1",a+=null==$("#option1").val()?"":" && $.b=='"+$("#option1").val()+"'",a+=null==$("#option2").val()?"":" && $.d=='"+$("#option2").val()+"'",a+=1==$("#hidmonthcompare").val()?" && ($.i==1 || $.j==1)":""},fillData:function(a){var c,d,b=Option.data;0==a&&($("#option1").empty(),$("#option2").empty(),$("#option3").empty(),$("#agescale").val("00"),$("#showlabel")[0].checked=!1,$("#arealevel").val("arealevel4"),$("#less")[0].checked=!1,$("#proportion")[0].checked=!1),1==a&&($("#option2").empty(),$("#option3").empty()),2==a&&$("#option3").empty(),0==a&&(c=Option.defaultValue,d=b.Where("$.f=='"+c+"'").Select("{option1val:$.b,option2val:$.d,option3val:$.f,}").ToArray()[0]),1>a&&(b=b.Where(Option.getCondition()),b.Distinct("$.b").Select(function(a){return $("<option value='"+a.b+"'>").text(a.c)[0]}).TojQuery().appendTo("#option1"),void 0==d?"":$("#option1").val(d.option1val)),2>a&&(b=b.Where(Option.getCondition()),b.Distinct("$.d").Select(function(a){return $("<option value='"+a.d+"'>").text(a.e)[0]}).TojQuery().appendTo("#option2"),void 0==d?"":$("#option2").val(d.option2val)),3>a&&(b=b.Where(Option.getCondition()),b.Distinct("$.f").ForEach(function(a){var b=$("<option value='"+a.f+"'>");b.text(a.g),$("#option3").append(b),$.data(b[0],"ageswitch",a.h),$.data(b[0],"lessswitch",a.i),$.data(b[0],"proportionswitch",a.j),$.data(b[0],"pluseswitch",a.av),$.data(b[0],"exchangeswitch",a.aw)}),void 0!=d&&$("#option3").val(d.option3val),$("#option3").change())},switchOption:function(){var b,c,d,a=$("#option3 option:selected")[0];$("#age").empty(),$("#age").siblings("button").find("span").empty(),b=$.data(a,"ageswitch"),c=$.data(a,"lessswitch"),d=$.data(a,"proportionswitch"),1!=b?($("#agescale").val("00"),$("#agescale").attr("disabled",""),$("#age").siblings("button").attr("disabled",""),$("#age").attr("disabled","")):($("#agescale").removeAttr("disabled"),$("#agescale").val("00"),get("ageband,"+$("#option3").val(),{datetype:$("#hiddatetype").val(),companycd:$("#hidcompanycd").val()},function(a){$.data(document,"ageband",Enumerable.From(a)),$("#agescale").change()})),1==$("#hidmonthcompare").val()&&0==$("#hiddatetype").val()?(1!=d?($("#proportion")[0].checked=!1,$("#proportion").attr("disabled","")):$("#proportion").removeAttr("disabled"),1!=c?($("#less")[0].checked=!1,$("#less").attr("disabled","")):($("#less").removeAttr("disabled"),$("#proportion")[0].checked||($("#less")[0].checked=!0))):($("#less").attr("disabled",""),$("#proportion").attr("disabled",""))},showDefaultLevel:function(){var e,f,g,a=$("#option3 option:selected")[0],b=$("#option3").val(),c=$.data(a,"exchangeswitch"),d=14;for(1==$("#hidmonthcompare").val()&&($("#less")[0].checked?d=24:$("#proportion")[0].checked&&(d=34)),e="[",f=d;d+10>f;f++)e+="$."+fields[f],d+9>f&&(e+=",");for(e+="]",g=$.data(document,"option").Where("$.f=='"+b+"'").Select(e).ToArray(),levelArray=[],f=0;f<g[0].length;f++)levelArray.push(1*g[0][f]),1==c||$("#proportion")[0].checked?$(".level-text"+(f+1)).text((100*g[0][f]).toFixed(1)+"%以上"):$(".level-text"+(f+1)).text(addKannma(g[0][f])+"以上")},showAgeLevel:function(){var e,f,g,a=$("#age").val(),b=$("#option3 option:selected")[0],c=$.data(b,"pluseswitch"),d=$.data(b,"exchangeswitch");if(!$("#proportion")[0].checked&&null!=a){for(e="",f=0;f<a.length;f++)e+="$.a=='"+a[f]+"'",f<a.length-1&&(e+=" || ");for(levelArray=[],f=3;13>f;f++)g=0,$.data(document,"ageband").Where(e).Select("$."+fields[f]).ForEach(function(a){a=1*a,1==d?g=a:1==c?g+=a:g=a}),levelArray.push(g),1==d||$("#proportion")[0].checked?$(".level-text"+(f-2)).text((100*g).toFixed(1)+"%以上"):$(".level-text"+(f-2)).text(addKannma(g)+"以上")}}},$(function(){$("#print").click(function(){return $(this).hasClass("disabled")?($.tremaps.showMessage("M-005"),void 0):(window.print(),void 0)}),$("#logout").click(function(){logout()}),$("#option1").change(function(){Option.fillData(1)}),$("#option2").change(function(){Option.fillData(2)}),$("#option3").change(function(){null!=$(this).val()&&(Option.switchOption(),Option.showDefaultLevel())}),$("#less").click(function(){if(1==$("#hidmonthcompare").val()){var a=$("#proportion");a[0].checked=!1,$(this)[0].checked=!0,Option.showDefaultLevel()}}),$("#proportion").click(function(){if(1==$("#hidmonthcompare").val()){var a=$("#less");a[0].checked=!1,$(this)[0].checked=!0,Option.showDefaultLevel()}}),$("#agescale").change(function(){var a=$("#age"),b=$(this).val(),c=null;a.removeAttr("disabled",""),a.siblings("button").removeAttr("disabled",""),"00"==b?(a.empty(),a.attr("disabled",""),a.siblings("button").attr("disabled",""),Option.showDefaultLevel()):c="05"==b?$.data(document,"ageband").Where("$.c=='05'"):$.data(document,"ageband").Where("$.c=='10'"),null!=c&&(a.empty(),c.Select(function(a){return $("<option value='"+a.a+"'>").text(a.b)[0]
}).TojQuery().appendTo(age)),a.selectpicker("refresh")}),$("#age").parent().on("hidden.bs.dropdown",function(){1==$("#hidmonthcompare").val()?Option.showDefaultLevel():Option.showAgeLevel()}),$("#yesterday").click(function(){$("#compare")[0].checked=!1,$comparemonth=$("#comparemonth"),$comparemonth.hide(),$comparemonth.empty()}),$("#month0").change(function(){var a=$("#yesterday");$(this).children("option:first").is(":selected")?a.removeAttr("disabled"):(a[0].checked=!1,a.attr("disabled","")),$("#compare")[0].checked&&Month.fillCompareMonth()}),$("#compare").click(function(){$("#yesterday")[0].checked=!1,$(this).is(":checked")?Month.fillCompareMonth():($comparemonth=$("#comparemonth"),$comparemonth.hide(),$comparemonth.empty())}),$("#rightmenu").on("click","#storedown",function(){$("#downfile").attr("src",url+"excel/store?companycd="+$.data(document,"companyCd"))}),$("#rightmenu").on("click","#competitordown",function(){$("#downfile").attr("src",url+"excel/competition?companycd="+$.data(document,"companyCd"))})}),UpdateFile=function(a){$("#updatefile input[name='companycd']").val($.data(document,"companyCd"));var b=new FormData($("#updatefile")[0]);$.ajax({url:a.url,type:"POST",data:b,async:!0,cache:!1,contentType:!1,processData:!1,success:function(){$.tremaps.showMessage(a.msg)},complete:function(){$('input[type="file"]').val(null)}})},DownLoadFile=function(a){var e,b=$.extend(!0,{method:"post"},a),c=$("#downfile"),d=$('<form target="downfile" method="'+b.method+'" />');d.attr("action",b.url);for(e in b.data)d.append('<input type="hidden" name="'+e+'" value="'+b.data[e]+'" />');c.append(d),d.submit(),d.remove()},InputLimit.prototype.getMapString=function(a,b,c){var e,f,d="";for(f=0;f<a.length;f++)e=a.charCodeAt(f),b[e]?(e=b[e],d+=e,c&&c.push(e)):d+=a.charAt(f);return d},InputLimit.prototype.exeMap=function(a,b,c){return this.getMapString(a,this["map_"+b.map],c)},InputLimit.prototype.getInfoString=function(a){var c,b="";for(c in a)b+=c+" : "+a[c]+"<br/>\n";return b},InputLimit.prototype.addEvent=function(a,b,c,d){a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(b,c,d):a.attachEvent("on"+b,function(){c.call(a,window.event)}))},InputLimit.prototype.getCaretPosition=function(a){if("selectionStart"in a)return a.selectionStart;if("selection"in a){a.focus();var b=a.selection.createRange();return b.moveStart("character",-a.value.length),b.text.length}return 0},InputLimit.prototype.setCaretPosition=function(a,b){var c;return"setSelectionRange"in a?(a.setSelectionRange(b,b),void 0):"createTextRange"in a?(c=a.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select(),void 0):(c=document.selection.createRange(),c.collapse(),c.moveEnd("character",b),c.moveStart("character",b),c.select(),void 0)},InputLimit.prototype.exeReplace=function(a,b,c,d,e){var h,i,f=this,g=a.value;e||a.blur(),d&&d.map?(h=[],i=f.exeMap(g,d,h),a.value=i.replace(b,""),c+=h.length):a.value=a.value.replace(b,""),e||a.focus(),f.setCaretPosition(a,c)},InputLimit.prototype.initWithExclusionPattern=function(a,b,c){var d,e,f;(this.ua.isiOS||!this.ua.isSafari)&&(d=this,e=!0,f="oninput"in window?"input":"propertychange",this.addEvent(a,f,function(){if(e){var g=a.value.search(b);g>-1&&(e=!1,d.ua.isIE6||d.ua.isIE7||d.ua.isIE9?setTimeout(function(){d.exeReplace(a,b,g,c),e=!0},1):d.ua.isiOS||d.ua.isAndroid?(d.exeReplace(a,b,g,null,!0),e=!0):(d.exeReplace(a,b,g,c),e=!0))}},!0))},InputLimit.prototype.initOnlyHankaku=function(a,b){this.type=1,this.initWithExclusionPattern(a,new RegExp("[^ -~]","g"),b)},InputLimit.prototype.initOnlyZenkaku=function(a,b){this.type=2,this.initWithExclusionPattern(a,new RegExp("[ -~]","g"),b)},InputLimit.prototype.initOnlyz2h=function(a,b){this.type=3,this.initWithExclusionPattern(a,new RegExp("[^0-9.]","g"),b)},InputLimit.prototype.initOnlyHankakuNumber=function(a,b){this.type=3,this.initWithExclusionPattern(a,new RegExp("[^0-9]","g"),b)},function(){function a(a,b,c,d){a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(b,c,d):a.attachEvent("on"+b,function(){c.call(a,window.event)}))}a(window,"load",function(){var a=new InputLimit;a.initOnlyz2h($("input.range")[0],{map:"z2h"}),a.initOnlyHankakuNumber($("input.range")[1],{map:"zenkakuNumber2hankakuNumber"})},!0)}();