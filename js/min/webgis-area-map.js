function initMap(){var c,d,e,a=$("#map"),b={lat:38.352256,lng:137.447687};map=$.tremaps.mapCreate(a,b),c=$("#mapheader")[0],map.controls[google.maps.ControlPosition.TOP].push(c),d=$("#save-widget")[0],map.controls[google.maps.ControlPosition.RIGHT].push(d),e=$("#businessarea1")[0],map.controls[google.maps.ControlPosition.LEFT].push(e)}function competitorGroup(a,b){switch(b){case 0:Enumerable.From(a).Distinct("$.d").OrderBy("$.e").Select(function(a){return $("<option value='"+a.d+"'>").text(a.e)[0]}).TojQuery().appendTo("#map-addstore .company");break;case 1:var c=$("#map-addstore .company").val();$("#map-addstore .subsidiary").empty(),Enumerable.From(a).Where("$.d=='"+c+"'").Distinct("$.f").OrderBy("$.g").Select(function(a){return $("<option value='"+a.f+"'>").text(a.g)[0]}).TojQuery().appendTo("#map-addstore .subsidiary");break;case 2:Enumerable.From(a).Distinct("$.b").OrderBy("$.c").Select(function(a){return $("<option value='"+a.b+"'>").text(a.c)[0]}).TojQuery().appendTo("#map-addstore .cla")}}function competitorAdd(a){var c,b='<div role="tabpanel" class="tab-pane active" id="map-addstore"><p style="border-bottom: 1px solid #CECECE;"><label>競合店登録</label></p><p class="form-control-item"><label>企業名</label><select class="form-control input-sm company" ></select></p><p class="form-control-item"><label>業態名</label><select class="form-control input-sm subsidiary" ></select></p><p class="form-control-item"><label>中分類</label><select class="form-control input-sm cla" ></select></p><p class="form-control-item"><label>店舗名</label><input type="text" class="form-control input-sm store" maxlength="30"></input></p><p class="form-control-item"><label>備考</label><input type="text" class="form-control input-sm mark" maxlength="100"></input></p><p class="form-control-item"><div style="width:220px;margin-left:5px;" class="address"><div id="loadingID"><div id="fountainTextG"><div id="fountainTextG_1" class="fountainTextG">L</div><div id="fountainTextG_2" class="fountainTextG">o</div><div id="fountainTextG_3" class="fountainTextG">a</div><div id="fountainTextG_4" class="fountainTextG">d</div><div id="fountainTextG_5" class="fountainTextG">i</div><div id="fountainTextG_6" class="fountainTextG">n</div><div id="fountainTextG_7" class="fountainTextG">g</div><div id="fountainTextG_8" class="fountainTextG">.</div><div id="fountainTextG_9" class="fountainTextG">.</div><div id="fountainTextG_10" class="fountainTextG">.</div></div></div></div></p><p class="form-control-item" style="border-bottom: 1px solid #CECECE;"><span><b>経</b>：<span class="lng">'+a.latLng.lng().toFixed(7)+"</span></span>"+'<span style="float:right;"><b>緯</b>：<span class="lat">'+a.latLng.lat().toFixed(7)+"</span></span></p>"+'<p class="form-control-item">'+'<button class="btn btn-sm btn-default btncancle">キャンセル</button>'+'<button class="btn btn-sm btn-warning btnsave">登録</button>'+"</p>"+"</div>";infowindow.setContent(b),infowindow.setPosition(a.latLng),infowindow.open(map),competitorGroup(competitordatas,0),competitorGroup(competitordatas,1),competitorGroup(competitordatas,2),c=new google.maps.Geocoder,c.geocode({location:a.latLng},function(a,b){address=b===google.maps.GeocoderStatus.OK?a[1]?a[1].formatted_address:"No results found":"Geocoder failed due to: "+b,$("#map-addstore .address").html(address),$company=$("#map-addstore .company"),$subsidiary=$("#map-addstore .subsidiary"),$cla=$("#map-addstore .cla"),$company.change(function(){competitorGroup(competitordatas,1)}),$("#map-addstore .btnsave,#map-addstore .btncancle").unbind("click"),$("#map-addstore .btnsave").click(function(){var l,a=$("#map-addstore .company").val(),b=$("#map-addstore .company option:selected").text(),c=$("#map-addstore .subsidiary").val(),d=$("#map-addstore .subsidiary option:selected").text(),e=$("#map-addstore .cla").val(),f=$("#map-addstore .cla option:selected").text(),g=$.trim($("#map-addstore .store").val()),h=$.trim($("#map-addstore .mark").val()),i=$("#map-addstore .address").text(),j=$("#map-addstore .lng").text(),k=$("#map-addstore .lat").text();return""==g?($.tremaps.showMessage("M-015"),void 0):(l={company:getMapPara().companycd,classcd:e,classname:f,kygcompany:a,kygcompanyname:b,subsidiary:c,subsidiaryname:d,storename:g,comment:h,address:i,longitude:j,latitude:k},post("dcompetition",l,function(b){$.tremaps.showMessage("M-016"),infowindow.open(null),cc();var d=e+"_"+a;-1!=$.inArray(d,classCompanyArray)&&(showCooperations(class0Array,class1Array),showCompetitors(classCompanyArray))}),void 0)}),$("#map-addstore .btncancle").click(function(){infowindow.open(null)})})}function drawMap(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(infowindow.setMap(null),clearMap(),c=Enumerable.From(levelArray),d=levelArray[0],bounds=new google.maps.LatLngBounds,e="",f=[],g=$("#hidarealvl1cd").val(),h=$("#hidarealvl2cd").val(),i=$("#hidarealvl3cd").val(),0!=i&&null!=i){for(j=0;j<b.length;j++)f.push(b[j].a);e=$("#arealevel").val().replace("area","")}else 0!=h&&null!=h?(f.push(h),e=$("#arealevel").val().replace("area","")+"_sikunion"):0!=g&&null!=g&&(f.push(g),e=$("#arealevel").val().replace("area","")+"_kenunion");for(k={},j=0;j<b.length;j++)l=b[j],l.b>=d?(m=c.Last("$<="+l.b),n=levelArray.indexOf(m),k[l.a]=colorLevel[n]):k[l.a]="#FFFFFF";for(j=0;j<f.length;j++)$.getJSON("/"+e+"/"+f[j]+".json?v=1.0.0.0",function(b){var d,e,f,g,h,i,j,l,m,n,o,p,c=[];for(void 0==b.length?c.push(b):c=b,d=0,e=0,f=0,g=0,h=0;h<c.length;h++){for(i=c[h],j=0;j<i.points.length;j++)l=i.points[j],m=l.lng,n=l.lat,0==d&&(d=m,e=m,g=n,f=n),m>e?e=m:d>m&&(d=m),n>g?g=n:f>n&&(f=n);o=new MapLabel({text:i.areaname,position:new google.maps.LatLng(i.lnglat.lat,i.lnglat.lng),fontSize:10,zIndex:1e3,align:"center"}),p=new google.maps.Polygon({paths:i.points,strokeColor:"#888787",strokeOpacity:.8,strokeWeight:1,fillColor:k[i.areacd],fillOpacity:.4,map:map,mapLabel:o}),blockArr.push(p),p.cd=i.areacd,p.lnglat=i.lnglat,p.addListener("click",function(){areaPop(this.cd,this.lnglat)})}bounds.extend(new google.maps.LatLng(g,e)),bounds.extend(new google.maps.LatLng(f,d)),map.fitBounds(bounds),map.setCenter(a),$("#showlabel")[0].checked&&showLabel()});areaTotal()}function areaPop(a,b){var c=getMapPara(),d=b,e='<div role="tabpanel" id="pop-area" class="tab-pane active"><div style="border-bottom: 1px solid #CECECE;display:inline-block;word-break:break-all;word-wrap:break-word;height:auto;width:200px;font-weight:bold;"><span>f0</span>&nbsp;</div><p class="form-control-item"><label>人口(人)</label><span>f1</span></p><p class="form-control-item"><label>T会員(人)</label><span>f2</span></p><p class="form-control-item"><label>T会員化率</label><span>f3%</span></p><p class="form-control-item"><label>あしあと利用者数(人)</label><span>f4</span></p><p class="form-control-item"><label>全店利用者数(人)</label><span>f5</span></p><p class="form-control-item"><label>全店未利用者数(人)</label><span>f6</span></p></div>';infowindow.setContent(e),infowindow.setPosition(d),infowindow.open(map),$("#pop-area span").hide(),get("A003,0",{arealevel:c.arealevel,areacd:a,datetype:c.datetype,yearmonthcd:c.yearmonthcd,companycd:c.companycd},function(a){e=e.replace("f0",a[0]["b"]),e=e.replace("f1",a[0]["c"]),e=e.replace("f2",a[0]["d"]),e=e.replace("f3",(100*a[0]["e"]).toFixed(1)),e=e.replace("f4",a[0]["f"]),e=e.replace("f5",a[0]["g"]),e=e.replace("f6",a[0]["h"]),infowindow.setContent(e)})}function areaTotal(){post("A002",getMapPara(),function(a){$("#businessarea1 .lbl1").text(a[0]["c"]),$("#businessarea1 .lbl2").text(a[0]["d"]),$("#businessarea1 .lbl3").text((100*a[0]["e"]).toFixed(1)),$("#businessarea1 .lbl4").text(a[0]["f"]),$("#businessarea1 .lbl5").text(a[0]["g"]),$("#businessarea1").show()})}function clearMap(){var a;for(a=0;a<blockArr.length;a++)blockArr[a].mapLabel.setMap(null),blockArr[a].setMap(null);for(blockArr=[],a=0;a<markerArr.length;a++)markerArr[a].setMap(null);markerArr=[],$.tremaps.ccInit()}function showLabel(){for(var a=0;a<blockArr.length;a++)null==blockArr[a].mapLabel.getMap()&&blockArr[a].mapLabel.setMap(map)}function hideLabel(){for(var a=0;a<blockArr.length;a++)blockArr[a].mapLabel.setMap(null)}var arrLength,areaArr,infowindow=new google.maps.InfoWindow({maxWidth:500}),blockArr=[],markerArr=[],download=0;