function initMap(){var c,d,e,f,a=$("#map"),b={lat:38.352256,lng:137.447687};map=$.tremaps.mapCreate(a,b),c=$("#mapheader")[0],map.controls[google.maps.ControlPosition.TOP].push(c),d=$("#save-widget")[0],map.controls[google.maps.ControlPosition.RIGHT].push(d),e=$("#settings")[0],map.controls[google.maps.ControlPosition.LEFT_TOP].push(e),f=$("#businessarea1")[0],map.controls[google.maps.ControlPosition.LEFT].push(f),f=$("#businessarea2")[0],map.controls[google.maps.ControlPosition.LEFT].push(f),f=$("#businessarea3")[0],map.controls[google.maps.ControlPosition.LEFT].push(f),lineArea=new google.maps.Polygon({clickable:!1,strokeColor:"#605ca8",strokeOpacity:1,strokeWeight:3,fillOpacity:.2}),freeBusinessArea=new google.maps.Polygon({strokeColor:"#605ca8",strokeOpacity:1,strokeWeight:3,fillOpacity:0})}function competitorGroup(a,b){switch(b){case 0:Enumerable.From(a).Distinct("$.d").OrderBy("$.e").Select(function(a){return $("<option value='"+a.d+"'>").text(a.e)[0]}).TojQuery().appendTo("#map-addstore .company");break;case 1:var c=$("#map-addstore .company").val();$("#map-addstore .subsidiary").empty(),Enumerable.From(a).Where("$.d=='"+c+"'").Distinct("$.f").OrderBy("$.g").Select(function(a){return $("<option value='"+a.f+"'>").text(a.g)[0]}).TojQuery().appendTo("#map-addstore .subsidiary");break;case 2:Enumerable.From(a).Distinct("$.b").OrderBy("$.c").Select(function(a){return $("<option value='"+a.b+"'>").text(a.c)[0]}).TojQuery().appendTo("#map-addstore .cla")}}function competitorAdd(a){var c,b='<div role="tabpanel" class="tab-pane active" id="map-addstore"><p style="border-bottom: 1px solid #CECECE;"><label>競合店登録</label></p><p class="form-control-item"><label>企業名</label><select class="form-control input-sm company" ></select></p><p class="form-control-item"><label>業態名</label><select class="form-control input-sm subsidiary" ></select></p><p class="form-control-item"><label>中分類</label><select class="form-control input-sm cla" ></select></p><p class="form-control-item"><label>店舗名</label><input type="text" class="form-control input-sm store" maxlength="30"></input></p><p class="form-control-item"><label>備考</label><input type="text" class="form-control input-sm mark" maxlength="100"></input></p><p class="form-control-item"><div style="width:220px;margin-left:5px;" class="address"><div id="loadingID"><div id="fountainTextG"><div id="fountainTextG_1" class="fountainTextG">L</div><div id="fountainTextG_2" class="fountainTextG">o</div><div id="fountainTextG_3" class="fountainTextG">a</div><div id="fountainTextG_4" class="fountainTextG">d</div><div id="fountainTextG_5" class="fountainTextG">i</div><div id="fountainTextG_6" class="fountainTextG">n</div><div id="fountainTextG_7" class="fountainTextG">g</div><div id="fountainTextG_8" class="fountainTextG">.</div><div id="fountainTextG_9" class="fountainTextG">.</div><div id="fountainTextG_10" class="fountainTextG">.</div></div></div></div></p><p class="form-control-item" style="border-bottom: 1px solid #CECECE;"><span><b>経</b>：<span class="lng">'+a.latLng.lng().toFixed(7)+"</span></span>"+'<span style="float:right;"><b>緯</b>：<span class="lat">'+a.latLng.lat().toFixed(7)+"</span></span>"+"</p>"+'<p class="form-control-item">'+'<button class="btn btn-sm btn-default btncancle">キャンセル</button>'+'<button class="btn btn-sm btn-warning btnsave">登録</button>'+"</p>"+"</div>";infowindow.setContent(b),infowindow.setPosition(a.latLng),infowindow.open(map),competitorGroup(competitordatas,0),competitorGroup(competitordatas,1),competitorGroup(competitordatas,2),c=new google.maps.Geocoder,c.geocode({location:a.latLng},function(a,b){address=b===google.maps.GeocoderStatus.OK?a[1]?a[1].formatted_address:"No results found":"Geocoder failed due to: "+b,$("#map-addstore .address").html(address),$company=$("#map-addstore .company"),$subsidiary=$("#map-addstore .subsidiary"),$cla=$("#map-addstore .cla"),$company.change(function(){competitorGroup(competitordatas,1)}),$("#map-addstore .btnsave,#map-addstore .btncancle").unbind("click"),$("#map-addstore .btnsave").click(function(){var l,a=$("#map-addstore .company").val(),b=$("#map-addstore .company option:selected").text(),c=$("#map-addstore .subsidiary").val(),d=$("#map-addstore .subsidiary option:selected").text(),e=$("#map-addstore .cla").val(),f=$("#map-addstore .cla option:selected").text(),g=$.trim($("#map-addstore .store").val()),h=$.trim($("#map-addstore .mark").val()),i=$("#map-addstore .address").text(),j=$("#map-addstore .lng").text(),k=$("#map-addstore .lat").text();return""==g?($.tremaps.showMessage("M-015"),void 0):(l={company:getMapPara().companycd,classcd:e,classname:f,kygcompany:a,kygcompanyname:b,subsidiary:c,subsidiaryname:d,storename:g,comment:h,address:i,longitude:j,latitude:k},post("dcompetition",l,function(b){$.tremaps.showMessage("M-016"),infowindow.open(null),cc();var d=e+"_"+a;-1!=$.inArray(d,classCompanyArray)&&(showCooperations(class0Array,class1Array),showCompetitors(classCompanyArray))}),void 0)}),$("#map-addstore .btncancle").click(function(){infowindow.open(null)})})}function drawPoly(a){return $("#businessarea .label").is("[areatype='6']")?($.tremaps.showMessage("M-047"),void 0):(linePath.unshift(a.latLng),null!=lineArea&&lineArea.setMap(null),lineArea.setPath(linePath),lineArea.setMap(map),void 0)}function circleTotals(){var c,d,e,f;1==storeArray.length&&(c=$("#businessarea .label").length,d=mapRegionShowArray.length,c==d&&(e=getMapPara(),f=$.tremaps.mapBusiness(),e.circletype=f.circletype,e.circlevalue=f.circlevalue,e.circlejyushos=f.circlejyushos,post("dcircletotals",{storecds:e.storecds,datetype:e.datetype,yearmonthcd:e.yearmonthcd,circletype:e.circletype,circlevalue:e.circlevalue,companycd:e.companycd,arealevel:e.arealevel,circlejyushos:e.circlejyushos},function(a){var b=Enumerable.From(a).Select("{population:$.c,tmember:$.d,tmemberrate:$.e,footprint:$.f,userforallstore:$.g,userforstore:$.h,circlename:$.i}").ToArray();$.tremaps.businessAreaTotal(b,0)})))}var infowindow=new google.maps.InfoWindow({maxWidth:500});