function initPage(a){var b=$(window).width(),c=$(window).height(),d=$("#top").height(),e=c-d-6,f=$("#loading").width(),g=$("#loading").height(),h=(c-g)/2,i=(b-f)/2;$("#leftmenu").height(e),$("#rightmenu").height(e),a&&($("#map").height(e),$("#mask").height(c),$("#mask").width(b),$("#loading").css("top",h),$("#loading").css("left",i),mapPopWindow())}function get(a,b,c,d){var f,g,e={async:!0,stopIfNull:!0};d="object"==typeof d&&d,$.extend(e,d),f="",g=a.split(","),f=g.length>1?url+urlpaths[g[0]].format(g[1]):void 0==urlpaths[g[0]]?g[0]:url+urlpaths[g[0]],b.ts=(new Date).getTime(),$.ajax({url:f,data:b,dataType:"json",async:e.async,success:function(a){return e.stopIfNull&&0==a.length?($.tremaps.showMessage("M-049"),void 0):(c(a),void 0)}})}function post(a,b,c,d){var e={async:!0,stopIfNull:!0};d="object"==typeof d&&d,$.extend(e,d),$.ajax({url:url+urlpaths[a],data:JSON.stringify(b),type:"post",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){return e.stopIfNull&&0==a.length?($.tremaps.showMessage("M-049"),void 0):(c(a),void 0)}})}function put(a,b,c,d){var f,g,e={async:!0,stopIfNull:!0};d="object"==typeof d&&d,$.extend(e,d),f="",g=a.split(","),f=g.length>1?url+urlpaths[g[0]].format(g[1]):void 0==urlpaths[g[0]]?g[0]:url+urlpaths[g[0]],$.ajax({url:f,data:JSON.stringify(b),type:"put",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){return e.stopIfNull&&0==a.length?($.tremaps.showMessage("M-049"),void 0):(c(a),void 0)},error:function(a){200==a.status&&$.tremaps.showMessage("編集成功しました。")}})}function mapPopWindow(){var c,d,e,f,g,h,i,j,a=$(document).height();$(document).width(),c=$("#top").height(),d=$("#mapheader").height(),e=a-c-d-40,f=$(".businessarea"),g=0,h=5,i=1,j=d+12,$("#pac-input").length>0&&(j+=$("#pac-input").height()+8,e-=35),f.each(function(){var a,b;popWindowHeight=$(this).height(),e-g>=popWindowHeight?(0==g?(a="top: "+j+"px!important; left: "+h+"px!important;",$(this).addClass("popfirst")):a="top: "+(j+g)+"px!important; left: "+h+"px!important;",g+=popWindowHeight+20):(b=$(".popfirst").width()+30,a="top: "+j+"px!important; left: "+b+"px!important;"),$("head").append("<style>#businessarea"+i+"{"+a+"}</style>"),i++})}var isIE=/msie/.test(navigator.userAgent.toLowerCase());isIE?$("head").append("<style>@media print{#map{max-height:24cm!important;}}</style>"):$("head").append("<style>@media print{#map{max-height:21cm!important;}}</style>"),$(document).ajaxStart(function(){$("#mask").show(),$("#loading").show()}).ajaxStop(function(){$("#mask").hide(),$("#loading").hide()}).ajaxError(function(a,b){$("#mask").hide(),$("#loading").hide();var e=$.parseJSON(b.responseText).msg;401==b.status?logout():400==b.status?$.tremaps.showMessage(e):401==b.status?$.tremaps.showMessage(e):500==b.status?$.tremaps.showMessage(e):502==b.status&&$.tremaps.showMessage(e)}).ajaxComplete(function(a,b){"timeout"==b.statusText&&$.tremaps.showMessage("请求超时")}),$(function(){$.support.transition=!1;var a=decodeURIComponent(getCookie("companyName"));$("#companyname").html(a),$("#companyname").attr("title",a),$("#loginuser").html(decodeURIComponent(getCookie("userName").replace("+","%20"))+"様"),initPage(!0),$(window).resize(function(){$("body").css("overflow","hidden"),initPage(!0),$("body").css("overflow","auto")}),$("#rightmenu").on("show.bs.collapse",function(){$("#rightmenu").fadeIn(500),$("#storeupdate div:eq(1)").attr("style","position: absolute; top: 0px; left: 0px; width: 210px; height: 43px; overflow: hidden; bottom: auto; right: auto;"),storeUploader.options.formData={companycd:$.data(document,"companyCd")}}),$("#rightmenu").on("hide.bs.collapse",function(){$("#rightmenu").fadeOut(500)}),$("#rightmenu").on("shown.bs.collapse",function(){initPage(!1)}),$("#rightmenu").on("click","a",function(){$("#rightmenu").collapse("hide")}),$("#leftmenu").on("shown.bs.collapse",function(){initPage(!1),$(".left-collapse").addClass("glyphicon-menu-left"),$(".left-collapse").removeClass("glyphicon-menu-right"),$(".navbar-title").css("background-color","#367FA9"),$(".navbar-title").css("border-right","none"),google.maps.event.trigger(map,"resize")}),$("#leftmenu").on("hidden.bs.collapse",function(){$(".left-collapse").removeClass("glyphicon-menu-left"),$(".left-collapse").addClass("glyphicon-menu-right"),$(".navbar-title").css("background-color","#3C8DBC"),$(".navbar-title").css("border-right","solid 1px #367FA9"),google.maps.event.trigger(map,"resize")}),$(".part-collapse").click(function(){var a=$(this).attr("target"),b=$(this).attr("toggle");$(this).removeClass("part-collapse-in"),$(this).siblings("img").addClass("part-collapse-in"),"show"==b?($("#"+a).show(),$(this).siblings("div").show(),$(this).siblings(".part-title").hasClass("show")||$(this).siblings(".part-title").hide()):($("#"+a).hide(),$(this).siblings("div").hide(),$(this).siblings(".part-title").show())}),$("#leftmenu").on("change","input[type='radio']",function(){$.each($("#leftmenu input[type='radio']:not(:checked)"),function(){$(this).parent().removeClass("btn-primary"),$(this).parent().removeClass("active"),$(this).parent().addClass("btn-default")}),$.each($("#leftmenu input[type='radio']:checked"),function(){$(this).parent().removeClass("btn-default"),$(this).parent().addClass("btn-primary"),$(this).parent().addClass("active")}),$(this).parent().siblings(".part-title").text($(this).parent().text()),$("#"+$(this).attr("target")).siblings(".tab-pane").removeClass("active"),$("#"+$(this).attr("target")).addClass("active")}),get("rightmenu",{},function(a){$.data(document,"auth",""==a.data?!1:!0),$(a.data).insertAfter($("#rightmenu div:first")),storeUploader=WebUploader.create({auto:!0,swf:"/js/webuploader-0.1.5/Uploader.swf",server:url+"excel/store",pick:{id:"#storeupdate",multiple:!1},accept:{title:"CSV",extensions:"csv",mimeTypes:"text/comma-separated-values"},onError:function(){var a=[].slice.call(arguments,0);"Q_TYPE_DENIED"==a[0]&&$.tremaps.showMessage("M-050")}}),storeUploader.on("uploadProgress",function(){$("#loading,#mask").show()}),storeUploader.on("uploadSuccess",function(){$.tremaps.showMessage("M-028")}),storeUploader.on("uploadError",function(){$.tremaps.showMessage("M-030")}),storeUploader.on("uploadComplete",function(a){$("#loading,#mask").hide(),storeUploader.removeFile(a)})})});