function bindCompany(a){a.isAdmin?($("#leftmenu").prepend(a.data),setDefault()):($.data(document,"companyCd",a.companycd),$.data(document,"companyName",a.companyname),$.data(document,"defaultCircleSize",a.defaultvalue),$.data(document,"defaultOption",a.storedefault),$.data(document,"defaultCate",a.categorydefault),$.data(document,"defaultRange",a.rangedefault));var b=$.data(document,"companyCd");get("mstores",{companycd:b},bindStore),get("mdates",{},Month.setData),get("mproducttitles",{companycd:b},bindProduct)}function setDefault(){var a=$("#company option:selected");$.data(document,"companyCd",a.val()),$.data(document,"companyName",a.text()),$.data(document,"defaultCircleSize",a.attr("defaultvalue")),$.data(document,"defaultOption",a.attr("storedefault")),$.data(document,"defaultCate",a.attr("categorydefault")),$.data(document,"defaultRange",a.attr("rangedefault"))}function bindStore(a){$.data(document,"store",Enumerable.From(a)),setStoreData(0)}function storeSearchCondition(){var a="1";return a+="すべて"==$("#store1").val()?"":" && $.c=='"+$("#store1").val()+"' ",a+="すべて"==$("#store2").val()?"":" && $.e=='"+$("#store2").val()+"' ",a+="すべて"==$("#store3").val()?"":" && $.f=='"+$("#store3").val()+"' ",a+="すべて"==$("#store4").val()?"":" && $.g=='"+$("#store4").val()+"' ",a+=""==$("#store5").val()||$("#store5").val().indexOf(",")>=0?"":" && $.h=='"+$("#store5").val()+"' "}function setStoreData(a){var b,c;1>a&&$("#store1").html($("<option>").text("すべて")),2>a&&$("#store2").html($("<option>").text("すべて")),3>a&&$("#store3").html($("<option>").text("すべて")),4>a&&$("#store4").html($("<option>").text("すべて")),5>a&&$("#store5").val(""),$("#store6").empty(),b=$.data(document,"store").Where(storeSearchCondition()),1>a&&b.Distinct("$.c").OrderBy("$.c").Select(function(a){return $("<option value='"+a.c+"'>").text(a.d)[0]}).TojQuery().appendTo("#store1"),2>a&&b.Distinct("$.e").OrderBy("$.j").Select(function(a){return $("<option value='"+a.e+"'>").text(a.e)[0]}).TojQuery().appendTo("#store2"),3>a&&b.Distinct("$.f").OrderBy("$.f").Select(function(a){return $("<option value='"+a.f+"'>").text(a.f)[0]}).TojQuery().appendTo("#store3"),4>a&&b.Distinct("$.g").OrderBy("$.g").Select(function(a){return $("<option value='"+a.g+"'>").text(a.g)[0]}).TojQuery().appendTo("#store4"),5>=a&&(b.Distinct("$.h").OrderBy("$.h*1").ForEach(function(a){var b=$("<option value='"+a.h+"'>");b.text(a.i),$("#store6").append(b),$.data(b[0],"longitude",a.x),$.data(b[0],"latitude",a.y)}),$("#store6").selectpicker("refresh"),1==b.Count()&&(c=b.Select("$.h").Single(),$("#store6").selectpicker("val",c)))}function bindProduct(a){var c,d,b=Enumerable.From(a);for(productLevelNum=b.Select("$.j").FirstOrDefault(),$(".product-p").hide(),c=1;productLevelNum>=c;c++)$("#product-p"+c).show(),d="$."+fields[c+1],$("#product-label"+c).text(b.Select(d).ToString()),$("#product"+c).html('<option value="0">すべて</option>');get("mproducts",{companycd:$.data(document,"companyCd")},bindProductSelect)}function bindProductSelect(a){$.data(document,"product",Enumerable.From(a));var b="$.c";$.data(document,"product").Distinct(b).Select(b).OrderBy(b).Select(function(a){return $("<option value='"+a+"'>").text(a)[0]}).TojQuery().appendTo("#product1")}function productSearchCondition(a){var c,d,b="1";for(c=1;a>=c;c++)d=$("#product"+c),b+="0"==d.val()?"":" && $."+fields[c+1]+"=='"+d.val()+"' ";return b}function setProductData(a){var b,c,d,e;for(b=a;productLevelNum>=b;b++)c=$("#product"+(b+1)),c.html("<option value='0'>すべて</option>");"0"!=$("#product"+a).val()&&(d=$.data(document,"product").Where(productSearchCondition(a)),e="$."+fields[a+2],d.Distinct(e).Select(e).OrderBy(e).Select(function(a){return $("<option value='"+a+"'>").text(a)[0]}).TojQuery().appendTo($("#product"+(a+1))))}function setTitle(){"すべて"!=$("#store1 option:selected").text()?$("#title-company").text($("#store1 option:selected").text()):$("#title-company").text(""),$("#title-store,#print-store").text(Enumerable.From($("#store6 option:selected")).ToString(" ","$.value+'/'+$.text")),$("#title-month,#print-month").text($("#month"+$("input[name='monthtype']:checked").val()+" option:selected").text());var a="";$("#proportion")[0].checked?a="(率)":"",$("#less")[0].checked?a="(差)":"",$("#title-item,#print-item").text($("#option3 option:selected").text()+a),"すべて"!=$("#store3 option:selected").text()&&"すべて"!=$("#store4 option:selected").text()?$("#title-product,#print-product").text(Enumerable.From($("#store3 option:selected,#store4 option:selected")).ToString(" / ","$.text")):"すべて"!=$("#store3 option:selected").text()&&"すべて"==$("#store4 option:selected").text()?$("#title-product,#print-product").text($("#store3 option:selected").text()):"すべて"==$("#store3 option:selected").text()&&"すべて"!=$("#store4 option:selected").text()?$("#title-product,#print-product").text($("#store4 option:selected").text()):$("#title-product,#print-product").text(""),null!=$("#age").val()&&$("#print-age").text(Enumerable.From($("#age option:selected")).ToString(" / ","$.text")),$("#print-circle").text(Enumerable.From($(".maphead-left .label")).ToString(" / ","$.innerHTML"))}function setMapPara(){var b,c,d,e,f,g,h,i,a=$.data(document,"companyCd");$("#hidcompanycd").val(a),b=$("input:radio[name='monthtype']:checked").val(),$("#hiddatetype").val(b),0==b&&$(".monthcompare:checked").length>0?$("#hidmonthcompare").val(1):$("#hidmonthcompare").val(0),Option.defaultValue=0!=$(".select-product option:selected[value!='0']").length?$.data(document,"defaultCate"):$.data(document,"defaultOption"),$.data(document,"tempCompanyCd")!=a||$.data(document,"tempDateType")!=b||$.data(document,"tempMonthCompare")!=$("#hidmonthcompare").val()?($.data(document,"tempCompanyCd")!=a&&(class0Array=[],class1Array=[],classCompanyArray=[],cc()),$.data(document,"tempDateType",b),$.data(document,"tempMonthCompare",$("#hidmonthcompare").val()),get("moptions",{companycd:a,datetype:b},Option.setData,{async:!1}),$.data(document,"tempCompanyCd",a)):Option.fillData(0),c=Enumerable.From($("#store6").selectpicker("val")).OrderBy().ToArray().join("_"),d=$("#month"+$("input:radio[name='monthtype']:checked").val()).val(),e=0,f="000000",g=null,h=null,0==b&&($("#yesterday")[0].checked&&(e=2),$("#compare")[0].checked&&(e=4,f=$("#comparemonth").val())),i=$(".select-product option:selected[value!='0']").parent().last(),null!=i&&(h=Enumerable.From($(".select-product option:selected[value!='0']")).ToString("_","$.value"),g=i.attr("productindex")),$("#hidstorecds").val(c),$("#hidyearmonthcd").val(d),$("#hiddatecompare").val(e),$("#hidddatespare").val(f),$("#hidprodlevel").val(g),$("#hidprodlevelnm").val(h),$("#hidoption").val($("#option3").val()),$("#hidoptiontype").val($("#agescale").val()),$("#hidoptionscales").val(null==$("#age").val()?"0000":$("#age").val().join("_")),$("#hidarealevel").val($("#arealevel").val()),$.data(document,"yeaterday",$("#yesterday")[0].checked),$.data(document,"compare",$("#compare")[0].checked)}function getMapPara(){var a={companycd:$("#hidcompanycd").val(),storecds:$("#hidstorecds").val(),datetype:$("#hiddatetype").val(),yearmonthcd:$("#hidyearmonthcd").val(),datecompare:$("#hiddatecompare").val(),datespare:$("#hidddatespare").val(),circletype:1,circlevalue:$.data(document,"defaultCircleSize"),option:$("#hidoption").val(),optiontype:$("#hidoptiontype").val(),optionscales:$("#hidoptionscales").val(),arealevel:$("#hidarealevel").val(),prodlevel:$("#hidprodlevel").val(),prodlevelnm:$("#hidprodlevelnm").val()};return"00"==a.optiontype&&(a.optionscales="0000"),a}$("#area").click(function(){location.href="area.html?from=store"}),$("#leftmenu").on("change","#company",function(){setDefault();var a=$(this).val();get("mstores",{companycd:a},bindStore),get("mproducttitles",{companycd:a},bindProduct),$("input[name='monthtype'][value='0']").click(),$("#yesterday")[0].checked=!1,$("#yesterday").removeAttr("disabled"),$("#compare")[0].checked=!1,$("#comparemonth").hide(),$("#month0").find("option:first")[0].selected=!0,$("#month1").find("option:first")[0].selected=!0,$("#month2").find("option:first")[0].selected=!0,storeUploader.options.formData={companycd:$.data(document,"companyCd")}}),$("#store6").selectpicker({size:"7",maxOptions:"5",style:"btn-default btn-sm btn-sel",doneButton:!0,container:"body"}),$("#store6").parent().on("hidden.bs.dropdown",function(){$.data(document,"tempSearch","")}),$("#age").selectpicker({size:"7",style:"btn-default btn-sm btn-sel"}),$("#store1").change(function(){setStoreData(1)}),$("#store2").change(function(){setStoreData(2)}),$("#store3").change(function(){setStoreData(3)}),$("#store4").change(function(){setStoreData(4)}),$("#store5").blur(function(){if(""==$(this).val()){var a=$("#store6").val();setStoreData(5),$("#store6").selectpicker("val",a)}else setStoreData(5)}).keyup(function(a){13==a.keyCode&&$(this).blur()}),$("#part3").on("change",".select-product",function(){var a=$(".select-product").index($(this))+1;setProductData(a)}),$("#btnquery").click(function(){var a,b;return null==$("#store6").val()?($.tremaps.showMessage("M-003"),void 0):($("#leftmenu").collapse("hide"),enableRight(),setMapPara(),a=getMapPara(),a.arealevel="arealevel4",storeArray=Enumerable.From($("#store6 option:selected")).Select("{storecd:$.value,storename:$.text,longitude:$.longitude,latitude:$.latitude}").ToArray(),Enumerable.From(storeArray).ForEach(function(a){var b=$("#store6 option[value='"+a.storecd+"']")[0];a.longitude=$.data(b,"longitude"),a.latitude=$.data(b,"latitude")}),b=/0*(.*)/,$.each(storeArray,function(){this.storecd=this.storecd.replace(b,"$1")}),setTitle(),storesCreate(1,0),void 0)}),$("#option-query").click(function(){var a,b;return 0!=$("#agescale").val()&&null==$("#age").val()?($.tremaps.showMessage("M-048"),void 0):($("#hidoption").val($("#option3").val()),$("#hidoptiontype").val($("#agescale").val()),$("#hidoptionscales").val(null==$("#age").val()?"0000":$("#age").val().join("_")),$("#hidarealevel").val($("#arealevel").val()),a=getMapPara(),a.option=$("#option3").val(),$("#proportion")[0].checked&&($.data(document,"yeaterday")&&(a.datecompare=1),$.data(document,"compare")&&(a.datecompare=3)),$("#hiddatecompare").val(a.datecompare),reShow(1),b="",$("#proportion")[0].checked?b="(率)":"",$("#less")[0].checked?b="(差)":"",$("#title-item,#print-item").text($("#option3 option:selected").text()+b),$("#title-product,#print-product").text(Enumerable.From($("#store3 option:selected,#store4 option:selected")).ToString(" / ","$.text")),null!=$("#age").val()&&$("#print-age").text(Enumerable.From($("#age option:selected")).ToString(" / ","$.text")),$("#print-circle").text(Enumerable.From($(".maphead-left .label")).ToString(" / ","$.innerHTML")),$("#showlabel")[0].checked&&$.tremaps.showMapLabel(),void 0)}),$("#downexcel").click(function(){var a,b;return $(this).hasClass("disabled")?($.tremaps.showMessage("M-004"),void 0):(a=getMapPara(),b=$.tremaps.mapBusiness(),a.circletype=b.circletype,a.circlevalue=b.circlevalue,a["circlejyushos"]=b.circlejyushos,DownLoadFile({url:url+"excel/map",data:a}),void 0)}),$("#showlabel").click(function(){$(this)[0].checked?$.tremaps.showMapLabel():$.tremaps.hideMapLabel()});